# 实验三：数值积分实验报告

## 1. 实验目的
- 理解数值积分的基本原理
- 实现并比较矩形法和梯形法两种数值积分方法
- 分析不同积分方法的收敛性和精度
- 探究步长对数值积分精度的影响

## 2. 实验原理
### 2.1 问题描述
计算定积分：
$$
I = \int_{0}^1 \sqrt{1-x^2} d x
$$
该积分表示1/4圆的面积，其解析解为 $\frac{1}{4}\pi \approx 0.7853981633974483$。

### 2.2 数值方法
#### 2.2.1 矩形法（左矩形法）
将积分区间 $[a,b]$ 等分为 $N$ 个子区间，每个子区间长度为 $h=(b-a)/N$，用左端点函数值近似该子区间上的平均函数值：
$$
\int_a^b f(x)dx \approx h\sum_{k=0}^{N-1} f(x_k), \quad x_k = a + kh
$$

#### 2.2.2 梯形法
同样将积分区间等分为 $N$ 个子区间，但使用梯形面积近似每个子区间上的积分：
$$
\int_a^b f(x)dx \approx \frac{h}{2}[f(a) + 2\sum_{k=1}^{N-1}f(x_k) + f(b)]
$$

## 3. 实验结果
### 3.1 数值结果
（填写不同N值下的计算结果表格）

| N | 矩形法结果 | 矩形法相对误差 | 梯形法结果 | 梯形法相对误差 |
|---|------------|----------------|------------|----------------|
| 10 | 1.5185244144|0.033277332943462204|1.5185244144            | 0.033277332943462204               |
| 100 |  1.5691342555        |     0.0010581074180623477           |       1.5691342555     |       0.0010581074180623477         |
| 1000 |   1.5707437385      |       3.34787476444498e-05         |     1.5707437385       |       3.34787476444498e-05         |
| 10000 |     1.5707946637   |      1.0587493629051964e-06          |     1.5707946637       |         1.0587493629051964e-06       |

### 3.2 误差分析图
![image](https://github.com/user-attachments/assets/1e2dc5b3-d054-44ee-82d7-69d84d7e4640)
从误差-步长关系图中可以观察到以下现象：

1. **误差随步长减小而减小**：
   - 矩形法和梯形法的误差都随着步长 \( h \) 的减小而减小。这表明步长越小，积分结果越接近精确值。

2. **梯形法的误差小于矩形法**：
   - 对于相同的步长 \( h \)，梯形法的误差明显小于矩形法。这是因为梯形法的收敛阶数更高（理论上为 \( O(h^2) \)），而矩形法的收敛阶数为 \( O(h) \)。

3. **理论收敛趋势与实际误差一致**：
   - 图中用虚线表示的理论收敛趋势 \( O(h^2) \) 与梯形法的误差曲线基本平行，验证了梯形法的二阶收敛性。
   - 矩形法的误差曲线斜率较小，符合其一阶收敛性。

4. **误差曲线的线性关系（对数坐标）**：
   - 在对数坐标下，误差与步长呈线性关系，表明误差与步长的幂次关系符合理论预期。

总结：
- 梯形法比矩形法更精确，尤其是在步长较小时。
- 梯形法的误差收敛速度更快，符合 \( O(h^2) \) 的理论收敛阶数。
- 这些现象验证了数值积分方法的理论特性。

## 4. 分析与讨论
### 4.1 收敛性分析
- 矩形法的收敛阶数： 
  矩形法的收敛阶数约为 **1**。从代码中 `calculate_convergence_rate` 函数的结果可以看出，矩形法的误差与步长 \( h \) 呈线性关系（误差 \( O(h) \)）。这是因为矩形法是基于左端点的近似积分方法，误差主要来源于函数曲线与矩形面积之间的差异。
- 梯形法的收敛阶数：  
  梯形法的收敛阶数约为 **2**。从 `calculate_convergence_rate` 函数的结果可以看出，梯形法的误差与步长 \( h \) 的平方成正比（误差 \( O(h^2) \)）。这是因为梯形法通过线性插值更好地近似了函数曲线，误差减少得更快。
- 两种方法收敛性的比较：  
  - **优劣分析**：梯形法的收敛速度明显快于矩形法。在相同的步长 \( h \) 下，梯形法的误差远小于矩形法的误差。  
  - **适用场景**：当需要更高精度时，梯形法更优，因为它在较小步长下即可达到较低的误差。而矩形法虽然简单，但误差较大，适合对精度要求不高的场景。  
  - **计算代价**：两种方法的计算复杂度相同，均为 \( O(N) \)，但梯形法的精度更高，因此在大多数情况下更具优势。

### 4.2 精度分析
- 在相同N值下两种方法精度的比较：
- ### 在相同 N 值下两种方法精度的比较
- **梯形法的精度高于矩形法**：  
  从代码中计算的误差结果可以看出，在相同的分割数 \( N \) 下，梯形法的误差明显小于矩形法的误差。这是因为梯形法通过线性插值更好地近似了函数曲线，而矩形法仅使用左端点值近似，导致误差较大。

- **误差随 \( N \) 增大而减小**：  
  随着 \( N \) 增大（步长 \( h \) 减小），两种方法的误差都逐渐减小，但梯形法的误差减小速度更快，符合其二阶收敛性。

- 影响精度的主要因素分析：步长 ( h ) 的大小：
步长 ( h = \frac{b-a}{N} ) 是影响精度的关键因素。步长越小，积分结果越接近精确值。矩形法的误差为 ( O(h) )，梯形法的误差为 ( O(h^2) )，因此梯形法对步长的敏感性更低。

被积函数的平滑性：
被积函数 ( f(x) = \sqrt{1-x^2} ) 在区间 ([-1, 1]) 内是连续且平滑的，因此数值积分方法能够较好地逼近。如果函数存在不连续点或剧烈变化，误差会显著增加。

方法的本质误差：
矩形法的误差来源于用矩形近似曲线下的面积，误差较大；梯形法通过线性插值，能够更好地逼近曲线，误差较小
- 如何选择合适的N值以达到期望精度：根据误差公式估算 ( N )：

矩形法的误差为 ( O(h) )，即 ( \text{误差} \approx C \cdot h )，其中 ( h = \frac{b-a}{N} )。
梯形法的误差为 ( O(h^2) )，即 ( \text{误差} \approx C \cdot h^2 )。
如果期望误差为 ( \epsilon )，可以通过公式反推出所需的 ( N )：
矩形法：( N \approx \frac{C \cdot (b-a)}{\epsilon} )
梯形法：( N \approx \sqrt{\frac{C \cdot (b-a)^2}{\epsilon}} )
实验验证：
通过逐步增大 ( N ) 的值，观察误差是否满足期望精度。例如，可以从小 ( N ) 开始，逐步加倍 ( N )，直到误差小于目标值。

平衡计算成本与精度：
( N ) 越大，计算成本越高。梯形法由于收敛速度更快，可以在较小的 ( N ) 下达到相同精度，因此在大多数情况下更优。



### 4.3 计算效率
- 计算时间随N的变化规律：
- 时间复杂度：
矩形法和梯形法的时间复杂度均为 ( O(N) )，因为两种方法都需要对 ( N ) 个子区间进行计算。随着 ( N ) 增大，计算时间呈线性增长。

实际表现：

在代码中，time_performance_test 函数可以测试在限定时间内两种方法能达到的最大分割数 ( N )。
随着 ( N ) 增大，计算时间逐渐增加，最终可能超过设定的最大时间限制。
影响因素：

( N ) 越大，计算时间越长。
梯形法比矩形法稍微多了一次加法操作（处理首尾点的权重），但总体时间差异可以忽略不计。
- 精度和计算时间的权衡：
- 精度与 ( N ) 的关系：

矩形法的误差为 ( O(h) )，即 ( O(1/N) )。要将误差降低 10 倍，需要将 ( N ) 增大 10 倍。
梯形法的误差为 ( O(h^2) )，即 ( O(1/N^2) )。要将误差降低 10 倍，仅需将 ( N ) 增大约 3.16 倍（(\sqrt{10})）。
因此，梯形法在相同精度要求下所需的 ( N ) 更小，计算时间更短。
如何选择 ( N )：

如果对精度要求较低，可以选择较小的 ( N )，以减少计算时间。
如果对精度要求较高，优先选择梯形法，因为它在较小的 ( N ) 下即可达到较高精度。
通过实验或误差公式估算 ( N )，避免盲目增大 ( N ) 导致计算时间浪费。
建议：

在实际应用中，先设定期望误差（如 ( 10^{-5} )），然后根据误差公式或实验结果选择合适的 ( N )。
梯形法通常是更优的选择，因为它在精度和计算时间之间提供了更好的平衡。


## 5. 结论
通过本次实验，我们比较了矩形法和梯形法在数值积分中的性能。实验结果表明，矩形法虽然实现简单，但误差较大，收敛速度较慢（收敛阶数约为1），适用于对精度要求不高的场景。而梯形法在误差和收敛速度上表现出明显优势，其收敛阶数达到2，能够在较少的计算步骤内获得更高的精度。尽管梯形法的实现稍显复杂，但其优越的精度和收敛性能使其成为需要高精度计算的首选方法。综合来看，梯形法在实际应用中更具优势，尤其是在计算成本允许的情况下，建议优先选择梯形法以获得更可靠的积分结果。

## 6. 思考题
1. 为什么梯形法通常比矩形法更精确？
梯形法比矩形法更精确，因为它通过用梯形近似曲线下的面积，考虑了区间端点的函数值并假设函数在区间内是线性的，这比矩形法的常数假设更贴近实际函数的变化趋势。从误差分析来看，梯形法的误差项为 O(h 
2
 )，而矩形法的误差项为 O(h)，因此梯形法在相同步长下误差更小，收敛速度更快。
2. 如果被积函数在积分区间内有奇点（如 $\int_0^1 \frac{1}{\sqrt{x}}dx$），这些方法是否仍然适用？为什么？
  当被积函数在积分区间内存在奇点时，矩形法和梯形法可能会失效，因为这些方法假设函数在区间内是光滑的，而奇点附近函数的变化非常剧烈，导致误差急剧增大。为了处理奇点，可以采用变量替换或使用自适应积分方法，在奇点附近使用更小的步长，以提高计算精度。
3. 如何改进这些方法以获得更高的精度？
为了获得更高的精度，可以采用更高阶的数值积分方法，如辛普森法（Simpson's Rule）或 Romberg 积分法，这些方法通过使用更高阶的多项式近似被积函数，显著减少误差。此外，自适应积分方法可以根据函数的局部变化动态调整步长，在函数变化剧烈的区域使用更小的步长，从而提高整体精度。对于含有奇点的积分，还可以使用专门的数值方法（如 Gauss-Legendre 积分）或进行变量替换以消除奇点。
## 附录：代码实现
```python
# 在此粘贴关键代码片段
```
